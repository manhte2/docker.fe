import{u as R,r as o,a as N,B as v,m as A,j as e,L as H,T as _,c as $,A as E,U as G,b,d as I,M as W,F as B,e as O,f as z,g as K,h as D,i as q,o as Q,H as S,I as Z,k as X,S as F,V as J,l as ee,n as U,p as se,q as te,R as ae,s as ne,t as re,v as ie,D as L}from"./index-DCVJyVHf.js";import{C as le}from"./Checkbox-CT2LGWNP.js";import{I as P}from"./IconQuesionMarkCircle-Dri560o-.js";const V=({accountId:d,status:u})=>{const c=R({name:"extensionSearchTerm",exact:!0}),[n,h]=o.useState(!1),[m,y]=o.useState(),[x,f]=o.useState([]),[p,a]=o.useState(1),[r,i]=o.useState(10);o.useEffect(()=>{(async()=>{try{const{data:s}=await N.get("/servers/server-to-migrate");f(s)}catch(s){console.log(s)}})()},[]),o.useEffect(()=>{l()},[p,c,r]);const l=async()=>{try{h(!0);const s=await N.get("/gists",{params:{status:u,userId:d,page:p,extension:c,pageSize:r}});y({data:s.data.data,totalItems:s.data.totalItems})}catch(s){console.log("error - ",s),v.error(A.error)}finally{h(!1)}},k=async(s,t)=>{try{await N.patch(`/gists/extension/${s}`,{extension:t})}catch{v.error(A.error)}},C=o.useMemo(()=>[{title:e.jsx("p",{className:"font-semibold font-primary",children:"Order code"}),dataIndex:"code",key:"code",render:(s,t)=>e.jsx(H,{to:`/admin/key/${t.keyId._id}`,className:"text-sm font-primary text-primary",children:s||"..............."})},{title:e.jsx("p",{className:"font-semibold font-primary",children:"Tên gói"}),dataIndex:"name",key:"name",width:150,render:(s,t)=>{var j;return e.jsx("p",{className:"text-sm font-primary",children:(j=t.planId)==null?void 0:j.name})}},{title:e.jsx("p",{className:"font-semibold font-primary",children:"Key"}),dataIndex:"key",key:"key",render:(s,t)=>{const{keyId:{accessUrl:j,keyId:M,serverId:g}}=t;return e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{title:"Copy link chính",children:e.jsx("button",{className:"text-white px-2 w-fit aspect-square rounded-md bg-secondary20",onClick:()=>{var w;return $(`${(w=t.keyId.awsId)==null?void 0:w.fileName.replace(/https/g,"ssconf")}#${t.extension}`)},children:e.jsx(E,{})})}),e.jsx(_,{title:"Copy link dự phòng",children:e.jsx("button",{className:"text-white px-2 w-fit aspect-square rounded-md bg-gray-400",onClick:()=>$(`${j}#${typeof g=="object"?g==null?void 0:g.name:g}-k${M}`),children:e.jsx(E,{})})})]})})}},{title:e.jsx("p",{className:"font-semibold font-primary",children:"Tên key"}),dataIndex:"extension",key:"extension",render:(s,t)=>e.jsx(G,{initialValue:t.extension,onSubmit:j=>{k(t._id,j),l(),v.success("Thay đổi thành công")}})},{title:e.jsx("p",{className:"font-semibold font-primary",children:"Trạng thái"}),dataIndex:"status",key:"status",width:130,render:(s,t)=>e.jsxs("div",{className:"text-sm font-primary space-y-1",children:[t.status===1&&e.jsx(b,{color:"green",children:e.jsx("span",{className:"font-primary",children:"Còn hạn"})}),t.status===0&&e.jsx(b,{color:"red",children:e.jsx("span",{className:"font-primary",children:"Hết hạn"})}),t.status===2&&e.jsx(b,{color:"blue",children:e.jsx("span",{className:"font-primary",children:"Migrate"})}),t.keyId.enable?"":e.jsx(b,{color:"red",children:e.jsx("span",{className:"font-primary",children:"Locked"})})]}),filters:[{text:"Còn hạn",value:1},{text:"Hết hạn",value:0}],onFilter:(s,t)=>typeof s=="boolean"?t.status===(s?1:0):t.status===s},{title:e.jsx("p",{className:"font-semibold font-primary",children:"Thời gian"}),dataIndex:"day",key:"day",width:120,render:(s,t)=>e.jsxs("p",{className:"text-sm font-primary",children:[I(t.keyId.startDate).format("DD/MM/YYYY")," ",e.jsx("br",{}),"-"," ",I(t.keyId.endDate).format("DD/MM/YYYY")]})},{title:e.jsx("p",{className:"font-semibold font-primary",children:"Data limit"}),dataIndex:"bandWidth",key:"bandWidth",width:120,render:(s,t)=>e.jsxs("p",{className:"text-sm font-primary",children:[t.keyId.dataLimit/1e3/1e3/1e3,"GB/",t.keyId.dataExpand/1e3/1e3/1e3,"GB"]}),sorter:{compare:(s,t)=>s.keyId.dataLimit-t.keyId.dataLimit,multiple:1}},{title:e.jsx("p",{className:"font-semibold font-primary",children:"Data Usage"}),dataIndex:"dataUsage",key:"dataUsage",width:150,render:(s,t)=>e.jsx("p",{className:"text-sm font-primary",children:t.keyId.dataUsage?`${(t.keyId.dataUsage/1e3/1e3/1e3).toFixed(2)}GB`:"0GB"}),sorter:{compare:(s,t)=>s.keyId.dataUsage-t.keyId.dataUsage,multiple:2}},{title:e.jsx("p",{className:"font-semibold font-primary text-sm"}),dataIndex:"action",key:"action",render:(s,t)=>t.status?e.jsx(W,{servers:x,gist:{key_id:t.keyId._id,key_name:t.keyId.name,server_id:t.keyId.serverId},handleReloadData:l}):null}],[x]),T=(s,t)=>{a(1),i(t)};return m?e.jsx("div",{className:"rounded-xl border-2 border-[#eeeeed] overflow-hidden",children:e.jsx(B,{dataSource:m.data,columns:C,loading:n,scroll:{x:1120},pagination:{defaultCurrent:1,total:m.totalItems,onChange:s=>a(s),pageSize:r,onShowSizeChange:T}})}):null},Y=()=>{const{setValue:d,watch:u}=O(),c=u("extensionSearchTerm");console.log("extensionSearchTermWatch ~",c);const[n,h]=o.useState("");o.useEffect(()=>{const x=setTimeout(()=>d("extensionSearchTerm",n),500);return()=>{clearTimeout(x)}},[n]);const m=x=>{const f=x.target.value;h(f)},y=()=>{h(""),d("extensionSearchTerm","")};return e.jsx("div",{className:"items-center block gap-5 mb-5 space-y-3 md:flex md:space-y-0",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:n,onChange:m,className:"focus:border-primary text-black text-sm font-medium placeholder:text-text4 py-[15px] px-[25px] rounded-[10px] border border-solid w-full bg-inherit peer outline-none border-strock",placeholder:"Tìm kiếm"}),n.length>0?e.jsx("span",{className:"absolute -translate-y-1/2 cursor-pointer right-5 top-1/2",onClick:y,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 text-icon-color",children:e.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z",clipRule:"evenodd"})})}):null]})})},ce=z({money:K().required("This field is required")}).required(),oe=({accountId:d})=>{const{t:u}=D(),{handleSubmit:c,control:n,setValue:h}=q({resolver:Q(ce),mode:"onSubmit"}),m=async y=>{var x;if(y.money>0){console.log("acgsc");try{F.fire({title:`<p class="leading-tight">${u("page.cash.payment.manual.ques")}<span class="text-secondary">${J.format(y.money)}VND</span></p>`,icon:"success",showCancelButton:!0,confirmButtonColor:"#1DC071",cancelButtonColor:"#d33",cancelButtonText:u("page.cash.payment.manual.cancelButton"),confirmButtonText:u("page.cash.payment.manual.confirmButton")}).then(async f=>{f.isConfirmed&&(await N.post("/cashs/cash-by-admin",{money:y.money,userId:d,content:"Admin nạp",description:""}),h("money",0),F.fire("<p class='leading-tight'>Nạp tiền thành công</p>"))})}catch(f){if(ee.isAxiosError(f))console.log("error message: ",f),v.error((x=f.response)==null?void 0:x.data.message);else return"An unexpected error occurred"}}else v.warn("Bạn nhập số tiền không hợp lệ")};return e.jsxs("div",{children:[e.jsx(S,{className:"mb-4",children:"Nạp tiền cho người dùng"}),e.jsxs("form",{className:"mt-5 flex items-center gap-5 w-full md:w-2/3",onSubmit:c(m),children:[e.jsx(Z,{min:0,type:"number",name:"money",placeholder:u("page.cash.payment.manual.form.placeholder"),control:n,containerclass:"flex-1"}),e.jsx(X,{type:"submit",className:"text-white bg-primary px-5",children:"Nạp tiền"})]})]})},ue=()=>{var C,T;const{t:d}=D(),u=q({mode:"all",defaultValues:{extensionSearchTerm:""}}),c=U(),{accountId:n}=se(),{role:h}=te(s=>s.auth),[m,y]=o.useState(),[x,f]=o.useState(),[p,a]=o.useState(),[r,i]=o.useState(!1);o.useEffect(()=>{(async()=>{var s,t,j,M;if(n)try{const[{data:g},{data:w}]=await Promise.all([N.get(`/satisfy/${n}`),N.get("/commisions")]);y({cash:((s=g.cash[0])==null?void 0:s.money)||0,rose:((t=g.rose[0])==null?void 0:t.money)||0,currentMoney:g.currentMoney,numberIntoduce:g.numberIntoduce,transaction:((j=g.transaction[0])==null?void 0:j.money)||0,discount:((M=g.discount[0])==null?void 0:M.totalAdjustedMoney)||0}),f({value:w.value,min:w.min})}catch(g){console.log("error - ",g)}})()},[n]),o.useEffect(()=>{n&&l()},[n]);const l=async()=>{try{const s=await N.get(`/users/${n}`);a(s.data),i(s.data.canMigrate)}catch(s){console.log("error - ",s)}},k=async(s,t)=>{try{await N.patch(`/users/${s}`,{canMigrate:t}),v("Success")}catch(j){console.log(j)}};return e.jsx(ae,{rolePage:[1,3],children:e.jsx(ne,{...u,children:e.jsxs("div",{className:"space-y-10",children:[m&&x&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 rounded-xl border-2 border-[#eeeeed]",children:[e.jsxs("div",{className:"flex-1 p-5 space-y-3",children:[e.jsx("p",{className:"text-base text-gray-500 lg:text-lg",children:d("page.dashboard.satify.cash")}),e.jsx("p",{className:"text-xl font-medium md:text-2xl",children:c(m.cash)})]}),e.jsxs("div",{className:"flex-1 p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-base text-gray-500 lg:text-lg",children:d("page.dashboard.satify.currentMoney")}),e.jsx(_,{title:d("page.dashboard.satify.currentMoneyNode"),children:e.jsx("span",{className:"cursor-pointer text-[#3d6dae]",children:e.jsx(P,{})})})]}),e.jsx("p",{className:"text-xl font-medium md:text-2xl",children:c((m==null?void 0:m.currentMoney)||0)})]}),e.jsxs("div",{className:"flex-1 hidden p-5 space-y-3 md:block",children:[e.jsx("p",{className:"text-base text-gray-500 lg:text-lg",children:d("page.dashboard.satify.transaction")}),e.jsx("div",{className:"",children:e.jsx("p",{className:"text-xl font-medium md:text-2xl text-error",children:c(m.transaction)})})]}),e.jsxs("div",{className:"flex-1 hidden p-5 space-y-3 md:block",children:[e.jsx("p",{className:"text-base text-gray-500 lg:text-lg",children:"Total Earn"}),e.jsx("div",{className:"",children:e.jsx("p",{className:"text-xl font-medium md:text-2xl text-error",children:c(m.discount)})})]}),e.jsxs("div",{className:"flex-1 hidden p-5 space-y-3 md:block",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-base text-gray-500 lg:text-lg",children:d("page.dashboard.satify.rose")}),e.jsx(_,{title:d("page.dashboard.satify.roseNode",{amount:x}),children:e.jsx("span",{className:"cursor-pointer text-[#3d6dae]",children:e.jsx(P,{})})})]}),e.jsx("p",{className:"text-xl font-medium md:text-2xl",children:c(m.rose)})]}),e.jsxs("div",{className:"flex-1 hidden p-5 space-y-3 md:block",children:[e.jsx("p",{className:"text-base text-gray-500 lg:text-lg",children:d("page.dashboard.satify.numberIntoduce")}),e.jsx("p",{className:"text-xl font-medium md:text-2xl",children:m.numberIntoduce})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{children:"Chi tiết người dùng"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(le,{checked:r,onClick:()=>i(s=>!s),children:"Can Migrate"}),e.jsx("button",{className:"px-4 py-2 text-xs font-medium text-white rounded-lg bg-primary font-primary shrink-0",onClick:()=>n&&k(n,r),children:"Apply"})]})]}),p?e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("p",{children:["Tên người dùng:"," ",e.jsx("span",{className:"font-medium",children:p.username})]}),e.jsxs("p",{children:["Email: ",e.jsx("span",{className:"font-medium",children:p.email})]}),e.jsxs("p",{children:["Số điện thoại:"," ",e.jsx("span",{className:"font-medium",children:p.phone})]}),e.jsxs("p",{children:["Mã giới thiệu:"," ",e.jsx("span",{className:"font-medium",children:p.introduceCode})]}),e.jsxs("p",{children:["Loại người dùng:"," ",e.jsx("span",{className:"font-medium",children:p.level===0?"Cộng tác viên":`Đại lý cấp ${p.level}`})]}),e.jsxs("p",{children:["Số dư:"," ",e.jsxs("span",{className:"font-medium",children:[" ",c(p.money)]})]}),e.jsxs("p",{children:["Quốc gia:"," ",e.jsx("span",{className:"font-medium",children:(C=re.find(s=>s.key===p.country))==null?void 0:C.title})]}),e.jsxs("p",{children:["Mục đích sử dụng:"," ",e.jsx("span",{className:"font-medium",children:(T=ie.find(s=>s.id===p.purpose))==null?void 0:T.title})]})]}):null]}),h&&h===1&&e.jsx(oe,{accountId:n||""}),e.jsxs("div",{children:[e.jsx(S,{className:"mb-4",children:"Danh sách key đã mua còn hạn"}),e.jsx(Y,{}),e.jsx(V,{accountId:n,status:1})]}),e.jsxs("div",{children:[e.jsx(S,{className:"mb-4",children:"Danh sách key đã mua hết hạn"}),e.jsx(Y,{}),e.jsx(V,{accountId:n,status:0})]}),e.jsx(de,{accountId:n}),e.jsx(me,{accountId:n})]})})})},de=({accountId:d})=>{const u=U(),{i18n:c,t:n}=D(),[h,m]=o.useState([]),[y,x]=o.useState(!1);o.useEffect(()=>{y&&f()},[y,d]);const f=o.useCallback(async()=>{try{const a=await N.get(`/cashs?userId=${d}`);m(a.data.map((r,i)=>({index:i,...r})))}catch(a){console.log("error - ",a),v.error(A.error)}},[d]),p=o.useMemo(()=>[{title:()=>e.jsx("p",{className:"font-semibold font-primary"}),dataIndex:"index",key:"index",width:70,render:a=>e.jsx("p",{className:"text-sm font-primary",children:a+1})},{title:()=>e.jsx("p",{className:"font-semibold font-primary",children:n("page.cash.history.field.code")}),dataIndex:"code",key:"code",render:a=>e.jsx("p",{className:"text-sm font-primary",children:a})},{title:e.jsx("p",{className:"font-semibold font-primary",children:n("page.cash.history.field.transactionType")}),dataIndex:"type",key:"type",render:a=>e.jsx("p",{className:"text-sm font-primary",children:a===0?e.jsx(b,{color:"blue",children:c.language==="ci"?"自动银行支付":"Auto Banking"}):e.jsx(b,{color:"pink-inverse",children:c.language==="ci"?"手动":"Manual Banking"})}),filters:[{text:c.language==="ci"?"自动银行支付":"Auto Banking",value:0},{text:c.language==="ci"?"手动":"Manual Banking",value:1}],onFilter:(a,r)=>typeof a=="boolean"?r.type===(a?1:0):r.type===a},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.money")}),dataIndex:"money",key:"money",render:a=>e.jsx("p",{className:"text-sm font-primary",children:u(a)}),sorter:(a,r)=>a.money-r.money},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.created_at")}),dataIndex:"createdAt",key:"createdAt",render:a=>e.jsx("p",{className:"text-sm font-primary",children:L(a)}),sorter:(a,r)=>I(a.createdAt).unix()-I(r.createdAt).unix()},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.updated_at")}),dataIndex:"updatedAt",key:"updatedAt",render:(a,r)=>e.jsx("p",{className:"text-sm font-primary",children:r.status!==2?L(a):null}),sorter:(a,r)=>I(a.updatedAt).unix()-I(r.updatedAt).unix()},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.status")}),dataIndex:"status",key:"status",render:(a,r)=>e.jsxs("div",{className:"text-sm font-primary",children:[r.status===0?e.jsx(b,{color:"red",children:e.jsx("span",{className:"font-primary",children:n("page.cash.history.status.reject")})}):null,r.status===1?e.jsx(b,{color:"green",children:e.jsx("span",{className:"font-primary",children:n("page.cash.history.status.approve")})}):null,r.status===2?e.jsx(b,{color:"lime",children:e.jsx("span",{className:"font-primary",children:n("page.cash.history.status.pending")})}):null]}),filters:[{text:n("page.cash.history.status.reject"),value:0},{text:n("page.cash.history.status.approve"),value:1},{text:n("page.cash.history.status.pending"),value:2}],onFilter:(a,r)=>typeof a=="boolean"?r.status===(a?1:0):r.status===a},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.content")}),dataIndex:"content",key:"content",render:a=>e.jsx("p",{className:"text-sm font-primary font-semibold",children:a})},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.description")}),dataIndex:"description",key:"description",render:a=>e.jsx("p",{className:"text-sm font-primary text-error",children:a})}],[n,c.language]);return e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{onClick:()=>x(!0),children:e.jsx(S,{className:"mb-4 cursor-pointer",children:"Lịch sử nạp tiền"})}),y&&e.jsx("div",{className:"rounded-xl border-2 border-[#eeeeed] overflow-hidden",children:e.jsx(B,{dataSource:h,columns:p,scroll:{x:1300,y:600}})})]})},me=({accountId:d})=>{const u=U(),{t:c,i18n:n}=D(),[h,m]=o.useState(!1),[y,x]=o.useState(!1),[f,p]=o.useState([]),a=async()=>{try{x(!0);const i=await N.get(`/transactions?userId=${d}&approve=true`);p(i.data.map((l,k)=>({index:k,...l})))}catch{v.error(A.error)}finally{x(!1)}};o.useEffect(()=>{h&&a()},[h,d]);const r=o.useMemo(()=>[{title:()=>e.jsx("p",{className:"text-base font-semibold font-primary"}),dataIndex:"index",key:"index",width:70,render:i=>e.jsx("p",{className:"text-sm font-primary",children:i+1})},{title:()=>e.jsx("p",{className:"font-semibold font-primary",children:c("page.transaction.field.code")}),dataIndex:"code",key:"code",render:i=>e.jsx("p",{className:"text-sm font-primary",children:i})},{title:e.jsx("p",{className:"font-semibold font-primary",children:c("page.transaction.field.package")}),dataIndex:"name",key:"name",render:(i,l)=>{var k;return e.jsx("p",{className:"text-sm font-primary",children:l.extendPlanId?l.extendPlanId.name:(k=l.planId)==null?void 0:k.name})}},{title:e.jsx("p",{className:"font-semibold font-primary",children:c("page.transaction.field.pricePackage")}),dataIndex:"price",key:"price",render:(i,l)=>e.jsx("p",{className:"text-sm font-primary",children:u(l.money/((100-l.discount)/100))}),sorter:{compare:(i,l)=>i.money/((100-i.discount)/100)-l.money/((100-l.discount)/100),multiple:3}},{title:e.jsx("p",{className:"font-semibold font-primary",children:"CK"}),dataIndex:"discount",key:"discount",render:(i,l)=>e.jsxs("p",{className:"text-sm font-primary",children:[l.discount,"%"]}),sorter:{compare:(i,l)=>i.discount-l.discount,multiple:2}},{title:e.jsx("p",{className:"font-semibold font-primary",children:c("page.transaction.field.disCountPrice")}),dataIndex:"money",key:"money",render:(i,l)=>e.jsx("p",{className:"text-sm font-primary",children:u(l.money)}),sorter:{compare:(i,l)=>i.money-l.money,multiple:1}},{title:e.jsx("p",{className:"font-semibold font-primary",children:c("page.transaction.field.createdAt")}),dataIndex:"createdAt",key:"createdAt",render:i=>e.jsx("p",{className:"text-sm font-primary",children:L(i)}),sorter:(i,l)=>I(i.createdAt).unix()-I(l.createdAt).unix()}],[c,n.language]);return e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{onClick:()=>m(!0),children:e.jsx(S,{className:"mb-4 cursor-pointer",children:"Lịch sử mua gói"})}),h&&e.jsx("div",{className:"rounded-xl border-2 border-[#eeeeed] overflow-hidden",children:e.jsx(B,{dataSource:f,columns:r,loading:y,scroll:{x:1180}})})]})};export{ue as default};
