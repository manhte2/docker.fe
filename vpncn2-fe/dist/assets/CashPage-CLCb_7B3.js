import{n as M,h as w,q as D,r as c,a as d,w as F,x as S,B as I,m as E,j as e,b as i,D as j,d as f,R as B,H as P,y as v,F as L,z as $,C as R,E as O,G as H,J as X}from"./index-DCVJyVHf.js";import Z from"./RechargePage-Dr-NrzAO.js";const q=()=>{const u=M(),{i18n:a,t:n}=w(),{_id:x}=D(t=>t.auth),[r,o]=c.useState([]),[h,y]=c.useState(),[g,m]=c.useState();c.useEffect(()=>{p()},[]),c.useEffect(()=>{const t=setInterval(()=>{r.forEach(s=>{const l=new Date().getTime(),T=new Date(s.createdAt).getTime(),_=10*60*1e3;s.status===2&&s.type===0&&l-T>_&&N(s)})},1e3);return()=>clearInterval(t)},[r]);const N=async t=>{try{console.log("abc");const s=await d.get("https://script.google.com/macros/s/AKfycby4nlJ_Q-Ppsf6V72FIZ5a7gM-HE8ZryCXiRRLHFZnnB94TX_FXJIWjMpeCNtvMdaz-_Q/exec");console.log("data - ",s.data.data),s.data.data.some(l=>t.content&&l["Giá trị"]>=t.money&&(l["Mô tả"].includes(t.content)||l["Mô tả"].toLowerCase().includes(t.content.toLowerCase())))?(await d.get(`/cashs/approve/${t._id}`),p()):(await d.post(`/cashs/reject/${t._id}`,{description:"We can not find out your payment. Please contact Admin"}),p())}catch(s){console.log(s)}},b=h&&g?r.filter(t=>F(t.createdAt,h)&&S(t.createdAt,g)):r,p=c.useCallback(async()=>{try{const t=await d.get(`/cashs?userId=${x}`);o(t.data)}catch(t){console.log("error - ",t),I.error(E.error)}},[x]),k=c.useMemo(()=>[{title:()=>e.jsx("p",{className:"font-semibold font-primary"}),dataIndex:"index",key:"index",width:70,render:t=>e.jsx("p",{className:"text-sm font-primary",children:t+1})},{title:()=>e.jsx("p",{className:"font-semibold font-primary",children:n("page.cash.history.field.code")}),dataIndex:"code",key:"code",render:(t,s)=>e.jsx(J,{code:t,cash:s,onSuccess:p})},{title:e.jsx("p",{className:"font-semibold font-primary",children:n("page.cash.history.field.transactionType")}),dataIndex:"type",key:"type",render:t=>e.jsx("p",{className:"text-sm font-primary",children:t===0?e.jsx(i,{color:"blue",children:a.language==="ci"?"自动银行支付":"Auto Banking"}):e.jsx(i,{color:"pink-inverse",children:a.language==="ci"?"手动":"Manual Banking"})}),filters:[{text:a.language==="ci"?"自动银行支付":"Auto Banking",value:0},{text:a.language==="ci"?"手动":"Manual Banking",value:1}],onFilter:(t,s)=>typeof t=="boolean"?s.type===(t?1:0):s.type===t},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.money")}),dataIndex:"money",key:"money",render:t=>e.jsx("p",{className:"text-sm font-primary",children:u(t)}),sorter:(t,s)=>t.money-s.money},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.created_at")}),dataIndex:"createdAt",key:"createdAt",render:t=>e.jsx("p",{className:"text-sm font-primary",children:j(t)}),sorter:(t,s)=>f(t.createdAt).unix()-f(s.createdAt).unix()},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.updated_at")}),dataIndex:"updatedAt",key:"updatedAt",render:(t,s)=>e.jsx("p",{className:"text-sm font-primary",children:s.status!==2?j(t):null}),sorter:(t,s)=>f(t.updatedAt).unix()-f(s.updatedAt).unix()},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.status")}),dataIndex:"status",key:"status",render:(t,s)=>e.jsxs("div",{className:"text-sm font-primary",children:[s.status===0?e.jsx(i,{color:"red",children:e.jsx("span",{className:"font-primary",children:n("page.cash.history.status.reject")})}):null,s.status===1?e.jsx(i,{color:"green",children:e.jsx("span",{className:"font-primary",children:n("page.cash.history.status.approve")})}):null,s.status===2?e.jsx(i,{color:"lime",children:e.jsx("span",{className:"font-primary",children:n("page.cash.history.status.pending")})}):null]}),filters:[{text:n("page.cash.history.status.reject"),value:0},{text:n("page.cash.history.status.approve"),value:1},{text:n("page.cash.history.status.pending"),value:2}],onFilter:(t,s)=>typeof t=="boolean"?s.status===(t?1:0):s.status===t},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.content")}),dataIndex:"content",key:"content",render:t=>e.jsx("p",{className:"text-sm font-primary font-semibold",children:t})},{title:()=>e.jsx("p",{className:"text-sm font-semibold font-primary",children:n("page.cash.history.field.description")}),dataIndex:"description",key:"description",render:t=>e.jsx("p",{className:"text-sm font-primary text-error",children:t})}],[n,a.language]),C=(t,s)=>{console.log(t,s),y(t)},A=(t,s)=>{console.log(t,s),m(t)};return e.jsxs(B,{rolePage:[2],children:[e.jsx(Z,{}),e.jsxs("div",{className:"mt-10 space-y-4 md:space-y-6",children:[e.jsxs(P,{children:[n("page.cash.history.heading")," ",u(r.filter(t=>t.status===1).map(t=>t.money).reduce((t,s)=>t+=s,0))]}),e.jsx("div",{className:"flex items-center justify-end gap-5",children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(v,{onChange:C,className:"!focus:border-primary text-black text-sm font-medium placeholder:text-text4 py-[15px] px-[25px] rounded-[10px] border border-solid w-full bg-inherit peer outline-none border-strock",placeholder:"Start date"}),e.jsx(v,{onChange:A,className:"!focus:border-primary text-black text-sm font-medium placeholder:text-text4 py-[15px] px-[25px] rounded-[10px] border border-solid w-full bg-inherit peer outline-none border-strock",placeholder:"End date"})]})}),e.jsx("div",{className:"rounded-xl border-2 border-[#eeeeed] overflow-hidden",children:e.jsx(L,{dataSource:b.map((t,s)=>({index:s,...t})),columns:k,scroll:{x:1300,y:600}})})]})]})},J=({code:u,cash:a,onSuccess:n})=>{const x=M(),{i18n:r,t:o}=w(),[h,y]=c.useState(!1),[g,m]=c.useState(!1),N=new Date().getTime(),b=new Date(a.createdAt).getTime(),p=10*60*1e3,k=()=>{m(!0)},C=()=>{m(!1)},A=()=>{m(!1)},t=async()=>{try{y(!0);const s=await d.get("https://script.google.com/macros/s/AKfycby4nlJ_Q-Ppsf6V72FIZ5a7gM-HE8ZryCXiRRLHFZnnB94TX_FXJIWjMpeCNtvMdaz-_Q/exec");console.log("data - ",s.data.data),s.data.data.some(l=>a.content&&l["Giá trị"]>=a.money&&(l["Mô tả"].includes(a.content)||l["Mô tả"].toLowerCase().includes(a.content.toLowerCase())))?await d.get(`/cashs/approve/${a._id}`):await d.post(`/cashs/reject/${a._id}`,{description:"We can not find out your payment. Please contact Admin"}),C(),n(),I("Success checked")}catch(s){console.log(s)}finally{y(!1)}};return e.jsxs(e.Fragment,{children:[h?e.jsx($,{className:"bg-[#00000027]"}):null,e.jsx("button",{className:"text-primary",onClick:k,children:u}),e.jsx(R,{title:r.language==="vi"?"Chi tiết giao dịch":r.language==="ci"?"交款的仔细":"Detail of transaction",footer:[],onCancel:A,open:g,centered:!0,children:e.jsxs("div",{className:"font-primary space-y-2 text-base relative",children:[e.jsxs("p",{children:[o("page.cash.history.field.code"),": ",a.code]}),e.jsxs("p",{children:[o("page.cash.history.field.transactionType"),":"," ",a.type===0?e.jsx(i,{color:"blue",children:r.language==="ci"?"自动银行支付":"Auto Banking"}):e.jsx(i,{color:"pink-inverse",children:r.language==="ci"?"手动":"Manual Banking"})]}),e.jsxs("p",{children:[o("page.cash.history.field.money"),":"," ",e.jsx("span",{className:"font-semibold",children:x(a.money)})]}),e.jsxs("p",{children:[o("page.cash.history.field.created_at"),":"," ",j(a.createdAt)]}),a.status!==2?e.jsxs("p",{children:[o("page.cash.history.field.updated_at"),":"," ",j(a.updatedAt)]}):null,e.jsxs("p",{children:[o("page.cash.history.field.status"),":"," ",a.status===0?e.jsx(i,{color:"red",children:e.jsx("span",{className:"font-primary",children:o("page.cash.history.status.reject")})}):null,a.status===1?e.jsx(i,{color:"green",children:e.jsx("span",{className:"font-primary",children:o("page.cash.history.status.approve")})}):null,a.status===2?e.jsx(i,{color:"lime",children:e.jsx("span",{className:"font-primary",children:o("page.cash.history.status.pending")})}):null]}),a.status===0&&a.description?e.jsxs("p",{children:[o("page.cash.history.field.description"),":"," ",e.jsx("span",{className:"text-error",children:a.description})]}):null,a.type===0&&e.jsx("img",{src:`https://img.vietqr.io/image/${O}-${H}-${X}.png?amount=${a.money}&addInfo=${a.content}`,className:"w-52 h-auto mx-auto py-5 object-cover"}),a.content?e.jsxs("p",{children:[r.language==="vi"?"Nội dung chuyển khoản":r.language==="ci"?"支付的内容":"Content",": ",e.jsx("span",{className:"text-primary",children:a.content})]}):null,a.status===2&&a.type===0&&N-b>p?e.jsx("div",{className:"mt-5",children:e.jsxs("p",{children:["Nếu bạn đã chuyển khoản vui lòng"," ",e.jsx("span",{className:"font-semibold text-primary underline cursor-pointer",onClick:t,children:"click vào đây"})," ","để kiểm tra lại. Nếu chưa được vui lòng liên hệ admin."]})}):null]})})]})};export{q as default};
