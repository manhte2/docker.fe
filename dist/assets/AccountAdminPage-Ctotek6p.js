import{f as W,g as Y,n as H,h as J,q as K,ad as Q,r as l,i as X,a as w,B as y,m as C,j as t,L as ee,D as te,d as T,R as se,F as ae,C as le,aa as re,ab as ne,k as ie,o as oe}from"./index-DCVJyVHf.js";import{R as ce}from"./Radio-DZfiCLHa.js";const de=[{id:0,title:"Cộng tác viên"},{id:1,title:"Đại lý cấp 1"},{id:2,title:"Đại lý cấp 2"},{id:3,title:"Đại lý cấp 3"}],me=W({level:Y().required("This field is required")}).required(),he=()=>{const v=H(),{i18n:I}=J(),c=K(e=>e.collab),L=Q(),r=new URLSearchParams(L.search).get("level"),[A,d]=l.useState(!1),[F,g]=l.useState(!1),[j,P]=l.useState([]),[a,m]=l.useState(void 0),[b,M]=l.useState(),[p,N]=l.useState(1),[n,S]=l.useState(""),[u,R]=l.useState(10),{handleSubmit:_,reset:$,setValue:x,watch:q}=X({resolver:oe(me),mode:"onSubmit"}),h=q("level");l.useEffect(()=>{a&&a.level&&x("level",a.level)},[a,x]),l.useEffect(()=>{f(p)},[p,u]),l.useEffect(()=>{const e=setTimeout(()=>f(1,n),500);return()=>{clearTimeout(e)}},[n]);const E=async e=>{try{a&&(await w.patch(`/users/${a==null?void 0:a._id}`,{...e,username:a.username,email:a.email}),f(p),y.success("Thành công"))}catch(s){console.log(s),y.error(C.error)}finally{m(void 0),U(),$()}},f=async(e,s)=>{var k;try{g(!0);const i={page:e,pageSize:u};r&&(i.level=r),s&&(i.username=s);const o=await w.get("/users",{params:i}),Z=(k=o==null?void 0:o.data)==null?void 0:k.resultList.filter(G=>G.role!==1);M(o.data.totalItems),P(Z)}catch{y.error(C.error)}finally{g(!1)}},O=()=>{d(!0)},U=()=>{d(!1)},z=()=>{d(!1)},B=l.useMemo(()=>[{title:()=>t.jsx("p",{className:"font-semibold font-primary",children:"STT"}),dataIndex:"index",key:"index",width:70,render:e=>t.jsx("p",{className:"text-sm font-primary",children:e+1})},{title:()=>t.jsx("p",{className:"text-sm font-semibold font-primary",children:"Username"}),dataIndex:"username",key:"username",render:(e,s)=>t.jsx(ee,{to:`/admin/account/${s._id}`,className:"text-sm font-primary text-primary",children:e})},{title:()=>t.jsx("p",{className:"text-sm font-semibold font-primary",children:"Mã giới thiệu"}),dataIndex:"introduceCode",key:"introduceCode",render:e=>t.jsx("p",{className:"text-sm font-primary",children:e})},{title:()=>t.jsx("p",{className:"text-sm font-semibold font-primary",children:"Tổng nạp"}),dataIndex:"cash",key:"cash",render:e=>t.jsx("p",{className:"text-sm font-primary",children:v(e||0)}),sorter:{compare:(e,s)=>e.cash-s.cash,multiple:1}},{title:()=>t.jsx("p",{className:"text-sm font-semibold font-primary",children:"Số dư"}),dataIndex:"money",key:"money",render:e=>t.jsxs("p",{className:"text-sm font-primary",children:[" ",v(e)]}),sorter:{compare:(e,s)=>e.money-s.money,multiple:1}},{title:()=>t.jsx("p",{className:"text-sm font-semibold font-primary",children:"Số gói"}),dataIndex:"transaction",key:"transaction",width:100,render:(e,s)=>t.jsx("p",{className:"text-sm font-primary",children:s.transaction}),sorter:{compare:(e,s)=>e.transaction-s.transaction,multiple:2}},{title:()=>t.jsx("p",{className:"text-sm font-semibold font-primary",children:"Đại lý"}),dataIndex:"level",key:"level",render:(e,s)=>t.jsx("p",{className:"text-sm cursor-pointer font-primary text-primary",onClick:()=>{m(s),O()},children:s.level===0?"Cộng tác viên":`Đại lý cấp ${s.level}`}),filters:[{text:"Cộng tác viên",value:0},{text:"Đại lý cấp 1",value:1},{text:"Đại lý cấp 2",value:2},{text:"Đại lý cấp 3",value:3}],onFilter:(e,s)=>typeof e=="boolean"?s.level===(e?1:0):s.level===e},{title:()=>t.jsx("p",{className:"text-sm font-semibold font-primary",children:"Ngày tạo"}),dataIndex:"createdAt",key:"createdAt",render:e=>t.jsx("p",{className:"text-sm font-primary",children:te(e)}),sorter:(e,s)=>T(e.createdAt).unix()-T(s.createdAt).unix()}],[I.language]),D=e=>{const s=e.target.value;S(s)},V=(e,s)=>{N(1),R(s)};return t.jsxs(se,{rolePage:[1,3],children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-5",children:[t.jsxs("div",{className:"relative w-1/2",children:[t.jsx("input",{type:"text",value:n,onChange:D,className:"focus:border-primary text-black text-sm font-medium placeholder:text-text4 py-[15px] px-[25px] rounded-[10px] border border-solid w-full bg-inherit peer outline-none border-strock",placeholder:"Tìm kiếm"}),n.length>0?t.jsx("span",{className:"absolute -translate-y-1/2 cursor-pointer right-5 top-1/2",onClick:()=>S(""),children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 text-icon-color",children:t.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z",clipRule:"evenodd"})})}):null]}),t.jsxs("p",{children:["Total user:"," ",t.jsx("span",{className:"font-semibold text-xl text-error",children:b})]})]}),t.jsx("div",{className:"rounded-xl border-2 border-[#eeeeed] overflow-hidden",children:t.jsx(ae,{dataSource:r?j.filter(e=>e.level===Number(r)).map((e,s)=>({index:s,...e})):j.map((e,s)=>({index:s,...e})),columns:B,loading:F,scroll:{y:420,x:1120},pagination:{defaultCurrent:1,total:b,onChange:e=>N(e),pageSize:u,onShowSizeChange:V}})})]})," ",t.jsx(le,{title:"Thay đổi cấp độ",open:A,onCancel:()=>{a&&m(void 0),z()},footer:[],children:t.jsxs("form",{className:"space-y-[15px] md:space-y-5",onSubmit:_(E),children:[t.jsxs(re,{children:[t.jsx(ne,{htmlFor:"name",children:"Cấp độ*"}),t.jsx("div",{className:"space-y-2",children:de.map(e=>t.jsx(ce,{checked:h||h===0?h===e.id:(a==null?void 0:a.level)===e.id,onClick:()=>x("level",e.id),children:t.jsxs("p",{className:"font-primary w-fit",children:[e.title," (",e.id!==0?`Chiết khấu [${e.id===1?c.level1:e.id===2?c.level2:e.id===3?c.level3:""}%]`:"",")"]})},e.id))})]}),t.jsx(ie,{type:"submit",className:"w-full text-white bg-primary",children:"Thay đổi"})]})})]})};export{he as default};
